<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Analysis - Public Insight Engine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .sidebar {
            width: 280px; height: 100vh; position: fixed; top: 0; left: 0;
            background-color: #fff; box-shadow: 0 0 20px rgba(0,0,0,0.1); padding-top: 1.5rem;
            display: flex; flex-direction: column;
        }
        .sidebar .logo { font-size: 1.8rem; font-weight: 700; color: #0d6efd; text-align: center; margin-bottom: 2rem; }
        .sidebar .nav-link {
            color: #495057; font-weight: 500; display: flex; align-items: center;
            padding: 0.75rem 1.5rem; margin: 0.25rem 1rem; border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        .sidebar .nav-link:hover { background-color: #e9ecef; color: #0d6efd; }
        .sidebar .nav-link.active { background-color: #0d6efd; color: #fff; }
        .sidebar .nav-link i { margin-right: 1rem; width: 20px; }
        .sidebar .logout-link { margin-top: auto; }
        .main-content { margin-left: 280px; padding: 2rem; }
        /* Upload box styles from landing page, slightly adapted */
        .upload-area { display: flex; gap: 1.5rem; justify-content: center; margin-bottom: 2.5rem; }
        .upload-box {
            border: 2px dashed #ced4da; padding: 2rem; border-radius: 1rem;
            cursor: pointer; transition: all 0.2s ease-in-out; width: 100%; max-width: 350px;
            background-color: #fff; text-align: center;
        }
        .upload-box:hover { border-color: #0d6efd; background-color: #f8f9fa; }
        .upload-box.uploaded { border-color: #198754; border-style: solid; }
        .upload-box svg { width: 48px; height: 48px; margin-bottom: 1rem; color: #6c757d; }
        .upload-box-title { font-weight: 600; color: #495057; }
        .upload-box-filename { font-size: 0.9rem; color: #0d6efd; margin-top: 0.5rem; word-break: break-all; font-weight: 500; }
        .btn-analyze { font-size: 1.2rem; padding: 0.75rem 2.5rem; border-radius: 50px; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h1 class="logo">PIE</h1>
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="dashboard.html"><i data-feather="home"></i> Dashboard</a></li>
            <li class="nav-item"><a class="nav-link active" href="analyze.html"><i data-feather="upload-cloud"></i> New Analysis</a></li>
            <li class="nav-item"><a class="nav-link" href="#"><i data-feather="user"></i> Profile</a></li>
            <li class="nav-item"><a class="nav-link" href="#"><i data-feather="settings"></i> Settings</a></li>
        </ul>
        <div class="logout-link">
             <ul class="nav flex-column"><li class="nav-item"><a class="nav-link" href="login.html"><i data-feather="log-out"></i> Logout</a></li></ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h2 class="h3 mb-4">Start a New Analysis</h2>
        <div class="card p-4 p-md-5">
            <div class="card-body text-center">
                <p class="lead text-muted mb-4">Upload the official notice PDF and the corresponding comments CSV file to begin.</p>
                <div class="upload-area">
                    <!-- PDF Upload Box -->
                    <label for="pdf-upload" class="upload-box" id="pdf-upload-box">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>
                        <span class="upload-box-title">Upload Notice PDF</span>
                        <div class="upload-box-filename" id="pdf-filename"></div>
                    </label>
                    <input type="file" id="pdf-upload" class="d-none" accept=".pdf">

                    <!-- CSV Upload Box -->
                    <label for="csv-upload" class="upload-box" id="csv-upload-box">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h1.5v-1.5M3.375 19.5v-1.5a1.125 1.125 0 0 1 1.125-1.125M1.5 15.75v-1.5a1.125 1.125 0 0 1 1.125-1.125M1.5 15.75h1.5v-1.5M1.5 15.75v1.5a1.125 1.125 0 0 1-1.125 1.125m18.375-3.375v1.5a1.125 1.125 0 0 1-1.125 1.125m1.125-1.125h-1.5v1.5m1.125-1.125v-1.5a1.125 1.125 0 0 0-1.125-1.125m-17.25 0h1.5v1.5m-1.5 0v-1.5a1.125 1.125 0 0 1 1.125-1.125m0 17.25v-1.5a1.125 1.125 0 0 0-1.125-1.125M3.375 4.5v-1.5a1.125 1.125 0 0 1 1.125-1.125M3.375 4.5h1.5v-1.5m-1.5 0V3.375c0-.621.504-1.125 1.125-1.125m17.25 1.125v1.5a1.125 1.125 0 0 1-1.125-1.125m1.125-1.125h-1.5v1.5m-1.5-1.5V3.375c0-.621-.504-1.125-1.125-1.125m-1.5 17.25h-1.5v-1.5m0 1.5v-1.5a1.125 1.125 0 0 0-1.125-1.125M9 9.375h6.75M9 12.75h6.75M9 16.125h6.75M12 21v-8.25a4.5 4.5 0 0 0-4.5-4.5H7.5a4.5 4.5 0 0 0-4.5 4.5v8.25" /></svg>
                        <span class="upload-box-title">Upload Comments CSV</span>
                        <div class="upload-box-filename" id="csv-filename"></div>
                    </label>
                    <input type="file" id="csv-upload" class="d-none" accept=".csv">
                </div>
                <!-- Button to start analysis -->
                <button id="start-analysis-btn" class="btn btn-primary btn-lg btn-analyze" disabled>Start Analysis</button>
                <!-- Alert message area -->
                <div id="alert-message" class="mt-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Activate Feather Icons
        feather.replace();

        // --- DOM ELEMENTS ---
        const startAnalysisBtn = document.getElementById('start-analysis-btn');
        const pdfUpload = document.getElementById('pdf-upload');
        const csvUpload = document.getElementById('csv-upload');
        const pdfFilename = document.getElementById('pdf-filename');
        const csvFilename = document.getElementById('csv-filename');
        const pdfUploadBox = document.getElementById('pdf-upload-box');
        const csvUploadBox = document.getElementById('csv-upload-box');
        const alertMessage = document.getElementById('alert-message');

        // --- EVENT LISTENERS ---
        pdfUpload.addEventListener('change', (e) => handleFileUpload(e, pdfFilename, pdfUploadBox));
        csvUpload.addEventListener('change', (e) => handleFileUpload(e, csvFilename, csvUploadBox));
        startAnalysisBtn.addEventListener('click', startAnalysis);

        /**
         * Handles UI updates when a file is selected.
         */
        function handleFileUpload(event, displayElement, boxElement) {
            if (event.target.files.length > 0) {
                displayElement.textContent = event.target.files[0].name;
                boxElement.classList.add('uploaded');
            } else {
                displayElement.textContent = '';
                boxElement.classList.remove('uploaded');
            }
            checkFilesUploaded();
        }

        /**
         * Enables the "Start Analysis" button only when both files are selected.
         */
        function checkFilesUploaded() {
            startAnalysisBtn.disabled = !(pdfUpload.files.length > 0 && csvUpload.files.length > 0);
        }

        /**
         * Simulates starting the analysis and redirecting the user.
         */
        function startAnalysis() {
            // Show a success message
            alertMessage.innerHTML = `
                <div class="alert alert-success" role="alert">
                    <strong>Success!</strong> Your analysis has been queued. Redirecting you to the dashboard...
                </div>
            `;
            // Disable the button to prevent multiple submissions
            startAnalysisBtn.disabled = true;

            // Redirect to the dashboard after a short delay
            setTimeout(() => {
                window.location.href = "dashboard.html";
            }, 2000); // 2-second delay before redirect
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
